[gd_scene load_steps=4 format=2]

[ext_resource path="res://Network.tscn" type="PackedScene" id=1]
[ext_resource path="res://swatch.tscn" type="PackedScene" id=2]

[sub_resource type="GDScript" id=1]
script/source = "extends Control

var playerHand

func _ready():
	$Network.connect(\"onConnectionFailed\", self, \"onConnectionFailed\")
	$Network.connect(\"onCardStarted\", self, \"onCardStarted\")
	$Network.connect(\"onCardFinished\", self, \"onCardFinished\")
	$Network.connect(\"onPlayerCards\", self, \"onPlayerCards\")
	$Network.connect(\"onStartSimulation\", self, \"onStartSimulation\")
	$PlayerLobby.connect(\"onReady\", self, \"onReady\")
	$PlayerLobby.connect(\"onUnready\", self, \"onUnready\")
	$PlayerLobby.connect(\"onInfoUpdated\", self, \"onInfoUpdated\")
	
	yield($Network, \"onGameStarted\")
	changeScene()	
	
func onConnectionFailed():
	pass # show some message? and retry???

func onStartSimulation():
	if playerHand:
		playerHand.startSimulation()

func onPlayerCards(cards):
	if playerHand:
		playerHand.setPlayerCards(cards)

func onCardStarted(card):
	if playerHand:
		playerHand.cardStarted(card)

func onCardFinished(card):
	if playerHand:
		playerHand.cardFinished(card)

func onReady():
	print(\"onReady\")
	$Network.rpc_id(0, \"playerReady\")
	
func onUnready():
	print(\"onUnready\")
	$Network.rpc_id(0, \"playerUnready\")

func onInfoUpdated(playerName, color):
	$Network.rpc_id(0, \"updateInfo\", playerName, color)
	
func onSwap(idx1, idx2):
	$Network.rpc_id(0, \"swapCards\", idx1, idx2)

func changeScene():
	remove_child($PlayerLobby)
	playerHand = load(\"res://player_hand.tscn\").instance()
	playerHand.connect(\"onSwap\", self, \"onSwap\")
	playerHand.connect(\"onReady\", self, \"onReady\")
	playerHand.connect(\"onUnready\", self, \"onUnready\")
	add_child(playerHand)"

[node name="PlayerScene" type="Control"]
anchor_right = 1.0
anchor_bottom = 1.0
script = SubResource( 1 )

[node name="Network" parent="." instance=ExtResource( 1 )]

[node name="PlayerLobby" parent="." instance=ExtResource( 2 )]
